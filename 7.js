(window.webpackJsonp=window.webpackJsonp||[]).push([[7,1],[,,,function(e,t,s){"use strict";function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.r(t),s.d(t,"default",(function(){return r}));class r{constructor(e){n(this,"element",void 0),n(this,"subElements",{}),n(this,"components",{})}async render(){return this.element=document.createElement("div"),this.element.innerHTML=this.template,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element),this.components=await this.getComponents(),Object.keys(this.components).forEach(e=>{this.subElements[e].append(this.components[e].element)}),this.initEventListeners(),this.element}initEventListeners(){}get template(){return"<div></div>"}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}async getComponents(){return{}}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},Object.values(this.components).forEach(e=>e.destroy()),this.components={}}}},,,,,,function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return c}));var n=s(3),r=s(16),i=s(14),a=s(11),o=s(10);var l=[{id:"id",title:"ID",sortable:!0,sortType:"number"},{id:"user",title:"Клиент",sortable:!0,sortType:"string"},{id:"createdAt",title:"Дата",sortable:!0,sortType:"custom",sortFunction:(e,t)=>new Date(e).getTime()-new Date(t).getTime(),template:e=>`\n        <div class='sortable-table__cell'>\n          ${new Date(e).toLocaleDateString(o.g,{year:"numeric",month:"long",day:"numeric"})}\n        </div>\n      `},{id:"totalCost",title:"Стоимость",sortable:!0,sortType:"number",template:e=>`\n        <div class='sortable-table__cell'>\n          $${e.toLocaleString(o.g)}\n        </div>\n      `},{id:"delivery",title:"Статус",sortable:!0,sortType:"string"}];class c extends n.default{constructor(e){var t,s,n;super(e),n=e=>{this.updateComponents({createdAt_gte:new Date(e.detail.from).toISOString(),createdAt_lte:new Date(e.detail.to).toISOString()})},(s="onDateSelect")in(t=this)?Object.defineProperty(t,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[s]=n}initEventListeners(){this.element.addEventListener("date-select",this.onDateSelect)}get template(){return'\n      <div class="sales full-height flex-column">\n        <div class="content__top-panel">\n          <h1 class="page-title">Продажи</h1>\n          <div data-element="rangePicker"></div>\n        </div>\n        <div data-element="sortableTable" class="full-height flex-column"></div>\n      </div>\n    '}async getComponents(){const e=new Date,t=new Date(e),s=new Date(e.setMonth(e.getMonth()-1));return{rangePicker:new r.a({from:s,to:t}),sortableTable:new i.a(l,{url:`${o.i}?createdAt_gte=${s.toISOString()}&createdAt_lte=${t.toISOString()}`,sorted:{id:"createdAt",order:"desc"}})}}async updateComponents(e={}){this.components.sortableTable.update(e).catch(e=>new a.a(e.message,{type:o.h.error}).show())}}},function(e,t,s){"use strict";s.d(t,"j",(function(){return n})),s.d(t,"l",(function(){return r})),s.d(t,"d",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"k",(function(){return o})),s.d(t,"c",(function(){return l})),s.d(t,"m",(function(){return c})),s.d(t,"i",(function(){return d})),s.d(t,"a",(function(){return h})),s.d(t,"f",(function(){return m})),s.d(t,"e",(function(){return u})),s.d(t,"g",(function(){return g})),s.d(t,"h",(function(){return p}));const n="api/dashboard/orders",r="api/dashboard/sales",i="api/dashboard/customers",a="api/dashboard/bestsellers",o="api/rest/products",l="api/rest/categories",c="api/rest/subcategories",d="api/rest/orders",h="https://course-js.javascript.ru/",m="https://api.imgur.com/3/image",u="28aaa2e823b03b1",g="ru-RU",p={success:"success",error:"error"}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e="",{duration:t=2e3,type:s=""}={}){this.message=e,this.duration=t,this.type=s,this.render()}render(){this.element=document.createElement("div"),this.element.innerHTML=`\n      <div class="notification notification_${this.type} show">\n        <div class="notification-body notification__content">${this.message}</div>\n      </div>\n    `,this.element=this.element.firstElementChild}show(e=document.body){n.currentNotification&&n.currentNotification.remove(),e.append(this.element),this.timeoutId=setTimeout(()=>{this.remove()},this.duration),n.currentNotification=this}remove(){this.element&&this.element.remove(),clearTimeout(this.timeoutId)}destroy(){this.remove(),this.element=null,n.currentNotification=null}}var r,i,a;a=null,(i="currentNotification")in(r=n)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a},function(e,t,s){"use strict";t.a=async function(e,t){let s,r;try{s=await fetch(e.toString(),t)}catch(e){throw new n(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{r=await s.json(),e=r.error&&r.error.message||r.data&&r.data.error&&r.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new n(s,r,t)}try{return await s.json()}catch(e){throw new n(s,null,e.message)}};class n extends Error{constructor(e,t,s){var n,r,i;super(s),i="FetchError",(r="name")in(n=this)?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})},,function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(11),r=s(12),i=s(10);function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class o{constructor(e=[],{url:t="",sortLocally:s=!1,sorted:r={id:e.find(e=>e.sortable).id,order:"asc"},scrollable:o=!0,rowUrl:l=null}={}){a(this,"element",void 0),a(this,"subElements",{}),a(this,"pageSize",30),a(this,"onWindowScroll",()=>{if(this.isRunning)return;if(window.scrollY+window.innerHeight>=document.documentElement.scrollHeight){this.isRunning=!0;const e=this.data.length,t=this.data.length+this.pageSize;this.loadData(e,t,!0).catch(e=>new n.a(e.message,{type:i.h.error}).show()).finally(()=>this.isRunning=!1)}}),a(this,"onPointerDown",e=>{const t=e.target.closest(".sortable-table__cell[data-sortable]");if(!t)return;this.sort(t.dataset.id,{asc:"desc",desc:"asc"}[t.dataset.order])}),this.headerConfig=e,this.rowUrl=l,this.url=new URL(t,i.a),this.sortLocally=s,this.sorted=r,this.scrollable=o,this.render().catch(e=>new n.a(e.message,{type:i.h.error}).show())}sortOnClient(e,t){this.updateSort(e,t),this.renderRows(this.sortData(e,t))}sortOnServer(e,t){this.updateSort(e,t),this.loadData().catch(e=>new n.a(e.message,{type:i.h.error}).show())}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onPointerDown),this.scrollable&&window.addEventListener("scroll",this.onWindowScroll)}async render(){this.element=document.createElement("div"),this.element.innerHTML=this.template,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element),await this.loadData(),this.initEventListeners()}async loadData(e=0,t=this.pageSize,s=!1){this.url.searchParams.set("_sort",this.sorted.id),this.url.searchParams.set("_order",this.sorted.order),this.url.searchParams.set("_start",String(e)),this.url.searchParams.set("_end",String(t)),this.element.classList.add("sortable-table_loading");const n=await Object(r.a)(this.url);s?this.appendRows(n):this.renderRows(n),this.element.classList.remove("sortable-table_loading")}setSearchParam(e,t){t?this.url.searchParams.set(e,t):this.url.searchParams.delete(e)}async update(e={}){Object.entries(e).forEach(([e,t])=>this.setSearchParam(e,t)),await this.loadData()}updateSort(e,t){this.sorted={id:e,order:t};const{header:s,arrow:n}=this.subElements;s.querySelectorAll("[data-sortable]").forEach(e=>{e.dataset.order=t}),s.querySelector(`[data-id="${e}"]`).appendChild(n)}toggleEmpty(){this.data.length?this.element.classList.remove("sortable-table_empty"):this.element.classList.add("sortable-table_empty")}renderRows(e){this.data=e,this.subElements.body.innerHTML=this.getTableRows(e),this.toggleEmpty()}appendRows(e){this.data.push(...e);const t=document.createElement("div");t.innerHTML=this.getTableRows(e),this.subElements.body.append(...t.childNodes),this.toggleEmpty()}get template(){return`\n      <div class="sortable-table">\n        <div data-element="header" class="sortable-table__header sortable-table__row">\n          ${this.headerConfig.map(e=>this.getHeaderCell(e)).join("")}\n        </div>\n        <div data-element="body" class="sortable-table__body"></div>\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          <div>Нет данных</div>\n        </div>\n      </div>\n    `}getHeaderCell({id:e,title:t,sortable:s}){return`\n      <div class="sortable-table__cell" data-id="${e}" ${s?'data-sortable=""':""} data-order="${this.sorted.order}">\n        <span>${t}</span>\n        ${e===this.sorted.id?'\n      <span data-element="arrow" class="sortable-table__sort-arrow">\n        <span class="sort-arrow"></span>\n      </span>\n    ':""}\n      </div>\n    `}getTableRows(e){return e.map(e=>this.getRowTemplate(e)).join("")}getRowTemplate(e){return this.rowUrl?`\n        <a class="sortable-table__row" href="${this.rowUrl(e)}">\n          ${this.getTableRow(e)}\n        </a>\n      `:`\n        <div class="sortable-table__row">\n          ${this.getTableRow(e)}\n        </div>\n      `}getTableRow(e){return this.headerConfig.map(({id:t,template:s})=>s?s(e[t]):`<div class='sortable-table__cell'>${e[t]}</div>`).join("")}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},this.scrollable&&window.removeEventListener("scroll",this.onWindowScroll)}sort(e,t){this.sortLocally?this.sortOnClient(e,t):this.sortOnServer(e,t)}sortData(e,t){const s=this.headerConfig.find(t=>t.id===e),n=s.sortType,r={string:(e,t)=>e.localeCompare(t,["ru","en"],{caseFirst:"upper"}),number:(e,t)=>e-t,custom:s.sortFunction},i={asc:1,desc:-1};return[...this.data].sort((s,a)=>i[t]*r[n](s[e],a[e]))}}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s(10);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const i=e=>(e.getDay()+7-1)%7,a=new Array(7).fill(1).map((e,t)=>new Date((new Date).setDate(t))).sort((e,t)=>i(e)-i(t)).map(e=>e.toLocaleDateString(n.g,{weekday:"short"})),o=new Array(12).fill(1).map((e,t)=>new Date((new Date).setMonth(t)).toLocaleDateString(n.g,{month:"long"}));class l{constructor({from:e=new Date,to:t=new Date}){r(this,"element",void 0),r(this,"subElements",{}),r(this,"onInputClick",()=>{this.element.classList.contains("rangepicker_open")?this.closeSelector():this.openSelector()}),r(this,"onSelectorClick",e=>{const t=e.target.closest(".rangepicker__cell");if(!t)return;const s=new Date(t.dataset.value);if(!this.selectionStarted)return this.selectionStarted=!0,this.selectionFrom=s,this.clearSelection(),void t.classList.add("rangepicker__selected-from");this.selectionStarted=!1;const n=e=>new Date(Math[e](this.selectionFrom.getTime(),s.getTime()));this.selectedRange.from=n("min"),this.selectedRange.to=n("max"),this.clearSelection(["rangepicker__selected-from"]),this.doSelection(),this.updateInput(),this.closeSelector()}),r(this,"onExternalClick",e=>{e.target.closest(".rangepicker")||this.closeSelector()}),r(this,"moveBackward",()=>{this.calendarVisibleFrom=this.addMonth(this.calendarVisibleFrom,-1),this.updateCalendar(this.calendarVisibleFrom)}),r(this,"moveForward",()=>{this.calendarVisibleFrom=this.addMonth(this.calendarVisibleFrom),this.updateCalendar(this.calendarVisibleFrom)}),this.selectedRange={from:e,to:t},this.calendarVisibleFrom=this.firstDayOfMonth(e),this.render(),this.initEventListeners()}firstDayOfMonth(e){const t=new Date(e);return t.setDate(1),t}addMonth(e,t=1){const s=new Date(e);return s.setMonth(s.getMonth()+t),s}addDay(e,t=1){const s=new Date(e);return s.setDate(s.getDate()+t),s}render(){const{from:e,to:t}=this.selectedRange;this.element=document.createElement("div"),this.element.innerHTML=`\n      <div class="rangepicker">\n        <div class="rangepicker__input" data-element="input">\n          <span data-element="from">${new Intl.DateTimeFormat(n.g).format(e)}</span> -\n          <span data-element="to">${new Intl.DateTimeFormat(n.g).format(t)}</span>\n        </div>\n        <div class="rangepicker__selector" data-element="selector"></div>\n      </div>\n    `,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element)}buildSelector(e){this.subElements.selector.innerHTML=`\n      <div class="rangepicker__selector-arrow"></div>\n      <div class="rangepicker__selector-control-left"></div>\n      <div class="rangepicker__selector-control-right"></div>\n      <div class="rangepicker__calendar">\n        ${this.getCalendarMonth(this.firstDayOfMonth(e))}\n      </div>\n      <div class="rangepicker__calendar">\n        ${this.getCalendarMonth(this.firstDayOfMonth(this.addMonth(e)))}\n      </div>\n    `,this.doSelection(),this.getLeft().addEventListener("click",this.moveBackward),this.getRight().addEventListener("click",this.moveForward)}updateCalendar(e){let t=this.firstDayOfMonth(e);this.subElements.selector.querySelectorAll(".rangepicker__calendar").forEach(e=>{e.innerHTML=this.getCalendarMonth(t),t=this.addMonth(t)}),this.doSelection()}getCalendarMonth(e){return`\n      <div class="rangepicker__month-indicator">\n        <time dateTime="${o[e.getMonth()]}">${o[e.getMonth()]}</time>\n      </div>\n      <div class="rangepicker__day-of-week">\n        ${a.map(e=>`<div>${e}</div>`).join("")}\n      </div>\n      <div class="rangepicker__date-grid">\n        ${this.getDates(e).map(e=>this.renderDate(e)).join("")}\n      </div>\n    `}getDates(e){const t=[];let s=e;for(;s<this.addMonth(e);)t.push(s),s=this.addDay(s);return t}renderDate(e){const t=1===e.getDate()?`style="--start-from: ${i(e)}"`:"";return`\n      <button type="button" class="rangepicker__cell" data-value="${e.toISOString()}" ${t}>\n        ${e.getDate()}\n      </button>\n    `}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}initEventListeners(){this.subElements.input.addEventListener("click",this.onInputClick),this.subElements.selector.addEventListener("click",this.onSelectorClick),document.addEventListener("click",this.onExternalClick,{capture:!0})}openSelector(){this.subElements.selector.childElementCount||this.buildSelector(this.selectedRange.from),this.element.classList.add("rangepicker_open")}closeSelector(){this.element.classList.remove("rangepicker_open")}updateInput(){const{from:e,to:t}=this.selectedRange;this.subElements.from.textContent=new Intl.DateTimeFormat(n.g).format(e),this.subElements.to.textContent=new Intl.DateTimeFormat(n.g).format(t),this.element.dispatchEvent(new CustomEvent("date-select",{bubbles:!0,detail:{from:e,to:t}}))}getLeft(){return this.subElements.selector.querySelector(".rangepicker__selector-control-left")}getRight(){return this.subElements.selector.querySelector(".rangepicker__selector-control-right")}clearSelection(e=["rangepicker__selected-from","rangepicker__selected-to","rangepicker__selected-between"]){const t=e.map(e=>"."+e).join(", ");this.subElements.selector.querySelectorAll(t).forEach(t=>t.classList.remove(...e))}doSelection(){const{from:e,to:t}=this.selectedRange;this.subElements.selector.querySelectorAll(".rangepicker__cell").forEach(s=>{const n=new Date(s.dataset.value);n.getTime()===e.getTime()?s.classList.add("rangepicker__selected-from"):t&&n.getTime()===t.getTime()?s.classList.add("rangepicker__selected-to"):t&&n>e&&n<t&&s.classList.add("rangepicker__selected-between")})}remove(){this.element&&this.element.remove()}destroy(){document.removeEventListener("click",this.onExternalClick,{capture:!0}),this.remove(),this.element=null,this.subElements={}}}}]]);
//# sourceMappingURL=7.js.map