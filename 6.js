(window.webpackJsonp=window.webpackJsonp||[]).push([[6,1],[,,,function(e,t,s){"use strict";function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.r(t),s.d(t,"default",(function(){return i}));class i{constructor(e){n(this,"element",void 0),n(this,"subElements",{}),n(this,"components",{})}async render(){return this.element=document.createElement("div"),this.element.innerHTML=this.template,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element),this.components=await this.getComponents(),Object.keys(this.components).forEach(e=>{this.subElements[e].append(this.components[e].element)}),this.initEventListeners(),this.element}initEventListeners(){}get template(){return"<div></div>"}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}async getComponents(){return{}}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},Object.values(this.components).forEach(e=>e.destroy()),this.components={}}}},,,,function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return m}));var n=s(3);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor({min:e=0,max:t=100,formatValue:s=(e=>e),selected:n={from:e,to:t}}={}){i(this,"element",void 0),i(this,"subElements",{}),i(this,"onPointerDown",e=>{this.target=e.target,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointermove",this.onPointerMove)}),i(this,"onPointerUp",()=>{this.element.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp),this.element.classList.remove("range-slider_dragging"),this.target=null,this.element.dispatchEvent(new CustomEvent("range-select",{bubbles:!0,detail:{from:this.selected.from,to:this.selected.to}}))}),i(this,"onPointerMove",e=>{const{left:t,right:s,width:n}=this.subElements.inner.getBoundingClientRect(),i=e.clientX;this.target===this.subElements.thumbLeft&&this.updateLeft(i<t?0:(i-t)/n),this.target===this.subElements.thumbRight&&this.updateRight(i>s?0:(s-i)/n)}),this.min=e,this.max=t,this.formatValue=s,this.selected=n,this.render(),this.initEventListeners()}render(){const e=this.getPercentLeft(),t=this.getPercentRight();this.element=document.createElement("div"),this.element.innerHTML=`\n      <div class="range-slider">\n        <span data-element="from">${this.formatValue(this.selected.from)}</span>\n        <div data-element="inner" class="range-slider__inner">\n          <span data-element="progress" class="range-slider__progress" style="left: ${e}; right: ${t}"></span>\n          <span data-element="thumbLeft" class="range-slider__thumb-left" style="left: ${e}"></span>\n          <span data-element="thumbRight" class="range-slider__thumb-right" style="right: ${t}"></span>\n        </div>\n        <span data-element="to">${this.formatValue(this.selected.to)}</span>\n      </div>\n    `,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element)}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}reset(){this.updateLeft(0),this.updateRight(0)}initEventListeners(){this.subElements.thumbLeft.addEventListener("pointerdown",this.onPointerDown),this.subElements.thumbRight.addEventListener("pointerdown",this.onPointerDown)}updateLeft(e){this.selected.from=this.calculateSelectedFrom(e),this.subElements.from.textContent=this.formatValue(this.selected.from);const t=this.getPercentLeft();this.subElements.progress.style.left=t,this.subElements.thumbLeft.style.left=t}updateRight(e){this.selected.to=this.calculateSelectedTo(e),this.subElements.to.textContent=this.formatValue(this.selected.to);const t=this.getPercentRight();this.subElements.progress.style.right=t,this.subElements.thumbRight.style.right=t}getPercentLeft(){return 100*(this.selected.from-this.min)/(this.max-this.min)+"%"}getPercentRight(){return 100*(this.max-this.selected.to)/(this.max-this.min)+"%"}calculateSelectedFrom(e){const t=this.min+(this.max-this.min)*e;return Math.min(this.selected.to,Math.round(t))}calculateSelectedTo(e){const t=this.max-(this.max-this.min)*e;return Math.max(this.selected.from,Math.round(t))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={}}}var a=s(14),l=s(11),o=s(10),d=s(13);var c=[{id:"images",title:"Фото",sortable:!1,template:e=>`\n        <div class="sortable-table__cell">\n          ${e.length?`<img class="sortable-table-image" alt="Image" src="${e[0].url}">`:""}\n        </div>\n      `},{id:"title",title:"Название",sortable:!0,sortType:"string"},{id:"subcategory",title:"Категория",sortable:!1,template:e=>`\n        <div class="sortable-table__cell">\n          <span data-tooltip="${Object(d.a)(function(e){return`\n    <div class="sortable-table-tooltip">\n      <span class="sortable-table-tooltip__category">${e.category.title}</span> /\n      <b class="sortable-table-tooltip__subcategory">${e.title}</b>\n    </div>\n  `}(e))}">${e.title}</span>\n        </div>\n      `},{id:"quantity",title:"Количество",sortable:!0,sortType:"number"},{id:"price",title:"Цена",sortable:!0,sortType:"number",template:e=>`\n        <div class="sortable-table__cell">\n          $${e.toLocaleString(o.g)}\n        </div>\n      `},{id:"status",title:"Статус",sortable:!0,sortType:"number",template:e=>`\n        <div class="sortable-table__cell">\n          ${e>0?"Активен":"Неактивен"}\n        </div>\n      `}];function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class m extends n.default{constructor(e){super(e),h(this,"onRangeSelect",e=>{const{from:t,to:s}=e.detail;this.updateComponents({price_gte:t,price_lte:s})}),h(this,"onFilterStatus",e=>{this.updateComponents({status:e.target.value})}),h(this,"onFilterName",e=>{this.updateComponents({title_like:e.target.value})})}async getComponents(){const e=new r({min:0,max:5e3,formatValue:e=>"$"+e}),t=new a.a(c,{url:o.k+"?_embed=subcategory.category",rowUrl:e=>"/products/"+e.id});return t.subElements.emptyPlaceholder.innerHTML='\n      <div>\n        <p>Не найдено товаров, удовлетворяющих выбранным критериям</p>\n        <button type="button" name="reset" class="button-primary-outline">Очистить фильтры</button>\n      </div>\n    ',{doubleSlider:e,sortableTable:t}}async updateComponents(e={}){this.components.sortableTable.update(e).catch(e=>new l.a(e.message,{type:o.h.error}).show())}initEventListeners(){this.element.addEventListener("range-select",this.onRangeSelect),this.subElements.filterStatus.addEventListener("change",this.onFilterStatus),this.subElements.filterName.addEventListener("input",this.onFilterName),this.element.querySelector('button[name="reset"]').addEventListener("click",()=>this.resetFilters())}resetFilters(){this.subElements.filterName.value="",this.subElements.filterStatus.value="",this.components.doubleSlider.reset();this.updateComponents({price_gte:"",price_lte:"",title_like:"",status:""})}get template(){return'\n      <div class="products-list">\n        <div class="content__top-panel">\n          <h1 class="page-title">Товары</h1>\n          <a href="/products/add" class="button-primary">Добавить товар</a>\n        </div>\n        <div class="content-box content-box_small">\n          <form class="form-inline">\n            <div class="form-group">\n              <label class="form-label">Сортировать по:</label>\n              <input type="text" data-element="filterName" class="form-control" placeholder="Название товара">\n            </div>\n            <div class="form-group" data-element="sliderContainer">\n              <label class="form-label">Цена:</label>\n              <div data-element="doubleSlider"></div>\n            </div>\n            <div class="form-group">\n              <label class="form-label">Статус:</label>\n              <select class="form-control" data-element="filterStatus">\n                <option value="">Любой</option>\n                <option value="1">Активный</option>\n                <option value="0">Неактивный</option>\n              </select>\n            </div>\n          </form>\n        </div>\n        <div data-element="sortableTable" class="products-list__container"></div>\n      </div>\n    '}}},,,function(e,t,s){"use strict";s.d(t,"j",(function(){return n})),s.d(t,"l",(function(){return i})),s.d(t,"d",(function(){return r})),s.d(t,"b",(function(){return a})),s.d(t,"k",(function(){return l})),s.d(t,"c",(function(){return o})),s.d(t,"m",(function(){return d})),s.d(t,"i",(function(){return c})),s.d(t,"a",(function(){return h})),s.d(t,"f",(function(){return m})),s.d(t,"e",(function(){return u})),s.d(t,"g",(function(){return b})),s.d(t,"h",(function(){return p}));const n="api/dashboard/orders",i="api/dashboard/sales",r="api/dashboard/customers",a="api/dashboard/bestsellers",l="api/rest/products",o="api/rest/categories",d="api/rest/subcategories",c="api/rest/orders",h="https://course-js.javascript.ru/",m="https://api.imgur.com/3/image",u="28aaa2e823b03b1",b="ru-RU",p={success:"success",error:"error"}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e="",{duration:t=2e3,type:s=""}={}){this.message=e,this.duration=t,this.type=s,this.render()}render(){this.element=document.createElement("div"),this.element.innerHTML=`\n      <div class="notification notification_${this.type} show">\n        <div class="notification-body notification__content">${this.message}</div>\n      </div>\n    `,this.element=this.element.firstElementChild}show(e=document.body){n.currentNotification&&n.currentNotification.remove(),e.append(this.element),this.timeoutId=setTimeout(()=>{this.remove()},this.duration),n.currentNotification=this}remove(){this.element&&this.element.remove(),clearTimeout(this.timeoutId)}destroy(){this.remove(),this.element=null,n.currentNotification=null}}var i,r,a;a=null,(r="currentNotification")in(i=n)?Object.defineProperty(i,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[r]=a},function(e,t,s){"use strict";t.a=async function(e,t){let s,i;try{s=await fetch(e.toString(),t)}catch(e){throw new n(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{i=await s.json(),e=i.error&&i.error.message||i.data&&i.data.error&&i.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new n(s,i,t)}try{return await s.json()}catch(e){throw new n(s,null,e.message)}};class n extends Error{constructor(e,t,s){var n,i,r;super(s),r="FetchError",(i="name")in(n=this)?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})},function(e,t,s){"use strict";t.a=e=>e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s(11),i=s(12),r=s(10);function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor(e=[],{url:t="",sortLocally:s=!1,sorted:i={id:e.find(e=>e.sortable).id,order:"asc"},scrollable:l=!0,rowUrl:o=null}={}){a(this,"element",void 0),a(this,"subElements",{}),a(this,"pageSize",30),a(this,"onWindowScroll",()=>{if(this.isRunning)return;if(window.scrollY+window.innerHeight>=document.documentElement.scrollHeight){this.isRunning=!0;const e=this.data.length,t=this.data.length+this.pageSize;this.loadData(e,t,!0).catch(e=>new n.a(e.message,{type:r.h.error}).show()).finally(()=>this.isRunning=!1)}}),a(this,"onPointerDown",e=>{const t=e.target.closest(".sortable-table__cell[data-sortable]");if(!t)return;this.sort(t.dataset.id,{asc:"desc",desc:"asc"}[t.dataset.order])}),this.headerConfig=e,this.rowUrl=o,this.url=new URL(t,r.a),this.sortLocally=s,this.sorted=i,this.scrollable=l,this.render().catch(e=>new n.a(e.message,{type:r.h.error}).show())}sortOnClient(e,t){this.updateSort(e,t),this.renderRows(this.sortData(e,t))}sortOnServer(e,t){this.updateSort(e,t),this.loadData().catch(e=>new n.a(e.message,{type:r.h.error}).show())}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onPointerDown),this.scrollable&&window.addEventListener("scroll",this.onWindowScroll)}async render(){this.element=document.createElement("div"),this.element.innerHTML=this.template,this.element=this.element.firstElementChild,this.subElements=this.getSubElements(this.element),await this.loadData(),this.initEventListeners()}async loadData(e=0,t=this.pageSize,s=!1){this.url.searchParams.set("_sort",this.sorted.id),this.url.searchParams.set("_order",this.sorted.order),this.url.searchParams.set("_start",String(e)),this.url.searchParams.set("_end",String(t)),this.element.classList.add("sortable-table_loading");const n=await Object(i.a)(this.url);s?this.appendRows(n):this.renderRows(n),this.element.classList.remove("sortable-table_loading")}setSearchParam(e,t){t?this.url.searchParams.set(e,t):this.url.searchParams.delete(e)}async update(e={}){Object.entries(e).forEach(([e,t])=>this.setSearchParam(e,t)),await this.loadData()}updateSort(e,t){this.sorted={id:e,order:t};const{header:s,arrow:n}=this.subElements;s.querySelectorAll("[data-sortable]").forEach(e=>{e.dataset.order=t}),s.querySelector(`[data-id="${e}"]`).appendChild(n)}toggleEmpty(){this.data.length?this.element.classList.remove("sortable-table_empty"):this.element.classList.add("sortable-table_empty")}renderRows(e){this.data=e,this.subElements.body.innerHTML=this.getTableRows(e),this.toggleEmpty()}appendRows(e){this.data.push(...e);const t=document.createElement("div");t.innerHTML=this.getTableRows(e),this.subElements.body.append(...t.childNodes),this.toggleEmpty()}get template(){return`\n      <div class="sortable-table">\n        <div data-element="header" class="sortable-table__header sortable-table__row">\n          ${this.headerConfig.map(e=>this.getHeaderCell(e)).join("")}\n        </div>\n        <div data-element="body" class="sortable-table__body"></div>\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          <div>Нет данных</div>\n        </div>\n      </div>\n    `}getHeaderCell({id:e,title:t,sortable:s}){return`\n      <div class="sortable-table__cell" data-id="${e}" ${s?'data-sortable=""':""} data-order="${this.sorted.order}">\n        <span>${t}</span>\n        ${e===this.sorted.id?'\n      <span data-element="arrow" class="sortable-table__sort-arrow">\n        <span class="sort-arrow"></span>\n      </span>\n    ':""}\n      </div>\n    `}getTableRows(e){return e.map(e=>this.getRowTemplate(e)).join("")}getRowTemplate(e){return this.rowUrl?`\n        <a class="sortable-table__row" href="${this.rowUrl(e)}">\n          ${this.getTableRow(e)}\n        </a>\n      `:`\n        <div class="sortable-table__row">\n          ${this.getTableRow(e)}\n        </div>\n      `}getTableRow(e){return this.headerConfig.map(({id:t,template:s})=>s?s(e[t]):`<div class='sortable-table__cell'>${e[t]}</div>`).join("")}getSubElements(e){const t={};for(const s of e.querySelectorAll("[data-element]"))t[s.dataset.element]=s;return t}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},this.scrollable&&window.removeEventListener("scroll",this.onWindowScroll)}sort(e,t){this.sortLocally?this.sortOnClient(e,t):this.sortOnServer(e,t)}sortData(e,t){const s=this.headerConfig.find(t=>t.id===e),n=s.sortType,i={string:(e,t)=>e.localeCompare(t,["ru","en"],{caseFirst:"upper"}),number:(e,t)=>e-t,custom:s.sortFunction},r={asc:1,desc:-1};return[...this.data].sort((s,a)=>r[t]*i[n](s[e],a[e]))}}}]]);
//# sourceMappingURL=6.js.map