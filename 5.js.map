{"version":3,"sources":["webpack:///./src/pages/base-page/index.js","webpack:///./src/components/product-form/icon-grab.svg","webpack:///./src/components/product-form/icon-trash.svg","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/constants/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/sortable-list/index.js"],"names":["BasePage","constructor","path","this","element","document","createElement","innerHTML","template","firstElementChild","subElements","getSubElements","components","getComponents","Object","keys","forEach","key","append","initEventListeners","parent","result","subElement","querySelectorAll","dataset","remove","destroy","values","component","ProductForm","productId","fileInput","getElementById","id","type","accept","hidden","addEventListener","onChange","click","event","file","target","files","disableImageUpload","formData","FormData","fetchJson","IMGUR_UPLOAD_URL","method","headers","Authorization","IMGUR_CLIENT_ID","body","referrer","then","response","addImage","url","data","link","source","name","catch","error","Notification","message","NOTIFICATION_TYPE","show","finally","enableImageUpload","preventDefault","save","success","defaultData","title","description","price","quantity","discount","status","images","render","URL","CATEGORIES_REST_URL","BACKEND_URL","searchParams","set","PRODUCTS_REST_URL","categories","products","Promise","all","loadCategories","loadProduct","resolve","setCategories","product","setProductData","loadData","eventType","JSON","stringify","getProductData","dispatchEvent","CustomEvent","bubbles","detail","productForm","elements","uploadImage","onUploadImage","onSubmit","category","subcategories","subCategory","push","text","subcategory","map","escapeHtml","join","createImageList","SortableList","items","image","createImageListItem","iconGrab","iconTrash","classList","add","disabled","getImages","setImages","imageList","querySelector","value","replaceChildren","Number","Page","super","ORDERS_URL","SALES_URL","CUSTOMERS_URL","BESTSELLERS_URL","SUBCATEGORIES_REST_URL","ORDERS_REST_URL","process","LOCALE","duration","currentNotification","timeoutId","setTimeout","clearTimeout","params","fetch","toString","err","FetchError","ok","errorText","statusText","json","Error","window","reason","alert","string","replace","item","closest","startDragging","clientX","clientY","x","shiftX","y","shiftY","moveAt","placeholder","top","bottom","getBoundingClientRect","offsetHeight","previousElementSibling","before","nextElementSibling","after","stopDragging","onPointerDown","style","left","indexFrom","getIndex","rect","width","height","createPlaceholder","parentElement","onPointerMove","onPointerUp","cssText","removeEventListener","indexTo","i","current"],"mappings":"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","file":"5.js","sourcesContent":["export default class BasePage {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(path) {\n\n  }\n\n  async render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = this.template;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    this.components = await this.getComponents();\n\n    Object.keys(this.components).forEach(key => {\n      this.subElements[key].append(this.components[key].element);\n    });\n\n    this.initEventListeners();\n\n    return this.element;\n  }\n\n  initEventListeners() {\n\n  }\n\n  get template() {\n    return `<div></div>`;\n  }\n\n  getSubElements(parent) {\n    const result = {};\n\n    for (const subElement of parent.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  async getComponents() {\n    return {};\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n    Object.values(this.components).forEach(component => component.destroy());\n    this.components = {};\n  }\n}\n","export default __webpack_public_path__ + \"components/product-form/icon-grab.svg\";","export default __webpack_public_path__ + \"components/product-form/icon-trash.svg\";","import SortableList from '../sortable-list/index.js';\nimport Notification from '../notification/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\nimport iconGrab from './icon-grab.svg';\nimport iconTrash from './icon-trash.svg';\n\nimport { NOTIFICATION_TYPE, PRODUCTS_REST_URL, CATEGORIES_REST_URL, BACKEND_URL, IMGUR_UPLOAD_URL, IMGUR_CLIENT_ID } from '../../constants/index.js';\n\nexport default class ProductForm {\n  element;\n  subElements = {};\n\n  onUploadImage = () => {\n    let fileInput = document.getElementById('imageUpload');\n\n    if (!fileInput) {\n      fileInput = document.createElement('input');\n      fileInput.id = 'imageUpload';\n      fileInput.type = 'file';\n      fileInput.accept = 'image/*';\n      fileInput.hidden = true;\n      fileInput.addEventListener('change', this.onChange);\n      this.element.append(fileInput);\n    }\n\n    fileInput.click();\n  }\n\n  onChange = event => {\n    const [file] = event.target.files;\n\n    if (!file) {\n      return;\n    }\n\n    this.disableImageUpload();\n\n    const formData = new FormData();\n    formData.append('image', file);\n\n    fetchJson(IMGUR_UPLOAD_URL, {\n      method: 'POST',\n      headers: {\n        Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\n      },\n      body: formData,\n      referrer: ''\n    })\n      .then(response => this.addImage({url: response.data.link, source: file.name}))\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show())\n      .finally(() => this.enableImageUpload());\n  }\n\n  onSubmit = event => {\n    event.preventDefault();\n\n    this.save()\n      .then(() => new Notification('Товар сохранен!', {type: NOTIFICATION_TYPE.success}).show())\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n\n  constructor(productId) {\n    this.productId = productId;\n    this.defaultData = {\n      title: '',\n      description: '',\n      price: 100,\n      quantity: 1,\n      discount: 0,\n      status: 1,\n      images: []\n    };\n    this.render()\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n\n  async loadCategories() {\n    const url = new URL(CATEGORIES_REST_URL, BACKEND_URL);\n    url.searchParams.set('_sort', 'weight');\n    url.searchParams.set('_refs', 'subcategory');\n    return await fetchJson(url);\n  }\n\n  async loadProduct(id) {\n    const url = new URL(PRODUCTS_REST_URL, BACKEND_URL);\n    url.searchParams.set('id', id);\n    return await fetchJson(url);\n  }\n\n  async loadData() {\n    const [categories, products] = await Promise.all([\n      this.loadCategories(),\n      this.productId ? this.loadProduct(this.productId) : Promise.resolve([this.defaultData])\n    ]);\n\n    this.setCategories(categories);\n\n    const [product] = products;\n    this.setProductData(product);\n  }\n\n  async render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = this.template;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    await this.loadData();\n\n    this.initEventListeners();\n  }\n\n  async save() {\n    const [method, eventType] = this.productId ? ['PATCH', 'product-updated'] : ['PUT', 'product-saved'];\n\n    const response = await fetchJson(new URL(PRODUCTS_REST_URL, BACKEND_URL), {\n      method: method,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(this.getProductData())\n    });\n\n    this.element.dispatchEvent(new CustomEvent(eventType, {\n      bubbles: true,\n      detail: {\n        response\n      }\n    }));\n  }\n\n  initEventListeners() {\n    this.subElements.productForm.elements.uploadImage.addEventListener('click', this.onUploadImage);\n    this.subElements.productForm.addEventListener('submit', this.onSubmit);\n  }\n\n  get template() {\n    return `\n      <div class='product-form'>\n        <form data-element='productForm' class='form-grid'>\n          <div class='form-group form-group__half_left'>\n            <fieldset>\n              <label class='form-label'>Название товара</label>\n              <input required='' type='text' name='title' id='title' class='form-control' placeholder='Название товара'>\n            </fieldset>\n          </div>\n          <div class='form-group form-group__wide'>\n            <label class='form-label'>Описание</label>\n            <textarea required='' class='form-control' name='description' id='description' placeholder='Описание товара'></textarea>\n          </div>\n          <div class='form-group form-group__wide'>\n            <label class='form-label'>Фото</label>\n            <div data-element='imageList'></div>\n            <button type='button' name='uploadImage' class='button-primary-outline fit-content'><span>Загрузить</span></button>\n          </div>\n          <div class='form-group form-group__half_left'>\n            <label class='form-label'>Категория</label>\n            <select class='form-control' name='subcategory' id='subcategory'></select>\n          </div>\n          <div class='form-group form-group__half_left form-group__two-col'>\n            <fieldset>\n              <label class='form-label'>Цена ($)</label>\n              <input required='' type='number' name='price' id='price' class='form-control' placeholder='100'>\n            </fieldset>\n            <fieldset>\n              <label class='form-label'>Скидка ($)</label>\n              <input required='' type='number' name='discount' id='discount' class='form-control' placeholder='0'>\n            </fieldset>\n          </div>\n          <div class='form-group form-group__part-half'>\n            <label class='form-label'>Количество</label>\n            <input required='' type='number' class='form-control' name='quantity' id='quantity' placeholder='1'>\n          </div>\n          <div class='form-group form-group__part-half'>\n            <label class='form-label'>Статус</label>\n            <select class='form-control' name='status' id='status'>\n              <option value='1'>Активен</option>\n              <option value='0'>Неактивен</option>\n            </select>\n          </div>\n          <div class='form-buttons'>\n            <button type='submit' name='save' class='button-primary-outline'>\n              Сохранить товар\n            </button>\n          </div>\n        </form>\n      </div>\n    `;\n  }\n\n  setCategories(data) {\n    const categories = [];\n\n    data.forEach(category => {\n      category.subcategories.forEach(subCategory => {\n        categories.push({\n          id: subCategory.id,\n          text: category.title + ' > ' + subCategory.title\n        });\n      });\n    });\n\n    this.subElements.productForm.elements.subcategory.innerHTML = categories.map(({id, text}) => {\n      return `\n        <option value=\"${id}\">${escapeHtml(text)}</option>\n      `;\n    }).join('');\n  }\n\n  createImageList(images) {\n    const sortableList = new SortableList({\n      items: images.map(image => this.createImageListItem(image))\n    });\n    return sortableList.element;\n  }\n\n  createImageListItem({url, source}) {\n    const element = document.createElement('div');\n\n    element.innerHTML = `\n      <li class='products-edit__imagelist-item sortable-list__item'>\n        <input type=\"hidden\" name=\"url\" value=\"${url}\">\n        <input type=\"hidden\" name=\"source\" value=\"${source}\">\n        <span>\n           <img src=\"${iconGrab}\" data-grab-handle=\"\" alt=\"grab\">\n           <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${url}\"><span>${source}</span>\n        </span>\n        <button type=\"button\">\n           <img src=\"${iconTrash}\" data-delete-handle=\"\" alt=\"delete\">\n        </button>\n      </li>\n    `;\n\n    return element.firstElementChild;\n  }\n\n  disableImageUpload() {\n    this.subElements.productForm.elements.uploadImage.classList.add('is-loading');\n    this.subElements.productForm.elements.uploadImage.disabled = true;\n  }\n\n  enableImageUpload() {\n    this.subElements.productForm.elements.uploadImage.classList.remove(\"is-loading\");\n    this.subElements.productForm.elements.uploadImage.disabled = false;\n  }\n\n  addImage(image) {\n    const images = this.getImages();\n    images.push(image);\n    this.setImages(images);\n  }\n\n  getImages() {\n    const images = [];\n\n    this.subElements.imageList.querySelectorAll('.sortable-list__item').forEach(element => {\n      const url = element.querySelector('input[name=\"url\"]').value;\n      const source = element.querySelector('input[name=\"source\"]').value;\n      images.push({url, source});\n    });\n\n    return images;\n  }\n\n  setImages(images) {\n    this.subElements.imageList.replaceChildren(this.createImageList(images));\n  }\n\n  getSubElements(parent) {\n    const result = {};\n\n    for (const subElement of parent.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  getProductData() {\n    const elements = this.subElements.productForm.elements;\n\n    const product = {\n      title: elements.title.value,\n      description: elements.description.value,\n      subcategory: elements.subcategory.value,\n      price: Number(elements.price.value),\n      quantity: Number(elements.quantity.value),\n      discount: Number(elements.discount.value),\n      status: Number(elements.status.value),\n      images: this.getImages()\n    };\n\n    if (this.productId) {\n      product.id = this.productId;\n    }\n\n    return product;\n  }\n\n  setProductData(product) {\n    const elements = this.subElements.productForm.elements;\n\n    elements.title.value = product.title;\n    elements.description.value = product.description;\n    if (product.subcategory) {\n      elements.subcategory.value = product.subcategory;\n    }\n    elements.price.value = product.price;\n    elements.quantity.value = product.quantity;\n    elements.discount.value = product.discount;\n    elements.status.value = product.status;\n    this.setImages(product.images);\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n  }\n}\n","import BasePage from '../../base-page/index.js';\nimport ProductForm from '../../../components/product-form/index.js';\n\nexport default class Page extends BasePage {\n  constructor(path) {\n    super(path);\n    this.productId = path[1];\n  }\n\n  async getComponents() {\n    const productForm = new ProductForm(this.productId);\n\n    return {\n      productForm\n    };\n  }\n\n  get template() {\n    return `\n      <div class=\"products-edit\">\n        <div class=\"content__top-panel\">\n          <h1 class=\"page-title\">\n            <a href=\"/products\" class=\"link\">Товары</a> / ${this.productId ? 'Редактировать' : 'Добавить'}\n          </h1>\n        </div>\n        <div class=\"content-box\">\n          <div data-element=\"productForm\"></div>\n        </div>\n      </div>\n    `;\n  }\n}\n\n","export const ORDERS_URL = 'api/dashboard/orders';\nexport const SALES_URL = 'api/dashboard/sales';\nexport const CUSTOMERS_URL = 'api/dashboard/customers';\nexport const BESTSELLERS_URL = 'api/dashboard/bestsellers';\n\nexport const PRODUCTS_REST_URL = 'api/rest/products';\nexport const CATEGORIES_REST_URL = 'api/rest/categories';\nexport const SUBCATEGORIES_REST_URL = 'api/rest/subcategories';\nexport const ORDERS_REST_URL = 'api/rest/orders';\n\nexport const BACKEND_URL = process.env.BACKEND_URL;\nexport const IMGUR_UPLOAD_URL = process.env.IMGUR_UPLOAD_URL;\nexport const IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\n\nexport const LOCALE = process.env.LOCALE;\n\nexport const NOTIFICATION_TYPE = {\n  success: 'success',\n  error: 'error'\n};\n","export default class Notification {\n\n  static currentNotification = null;\n\n  constructor(message = '', {duration = 2000, type = ''} = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = `\n      <div class=\"notification notification_${this.type} show\">\n        <div class=\"notification-body notification__content\">${this.message}</div>\n      </div>\n    `;\n    this.element = this.element.firstElementChild;\n  }\n\n  show(element = document.body) {\n    if (Notification.currentNotification) {\n      Notification.currentNotification.remove();\n    }\n\n    element.append(this.element);\n\n    this.timeoutId = setTimeout(() => {this.remove()}, this.duration)\n    Notification.currentNotification = this;\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n    clearTimeout(this.timeoutId);\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    Notification.currentNotification = null;\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function(url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch(err) {\n    throw new FetchError(response, \"Network error has occurred.\");\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\n    } catch (error) { /* ignore failed body */ }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch(err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = \"FetchError\";\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n\n","export default string => string\n  .replace(/&/g, '&amp;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#39;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n","export default class SortableList {\n  element;\n\n  onPointerDown = event => {\n    const item = event.target.closest('.sortable-list__item');\n\n    if (item) {\n      if (event.target.closest('[data-grab-handle]')) {\n        event.preventDefault();\n        this.startDragging(event.clientX, event.clientY, item);\n      }\n\n      if (event.target.closest('[data-delete-handle]')) {\n        event.preventDefault();\n        item.remove();\n      }\n    }\n  }\n\n  onPointerMove = event => {\n    const item = this.element.querySelector('.sortable-list__item.sortable-list__item_dragging');\n    if (!item) {\n      return;\n    }\n\n    event.preventDefault();\n\n    const x = event.clientX - this.shiftX;\n    const y = event.clientY - this.shiftY;\n    this.moveAt(x, y, item);\n\n    const placeholder = this.element.querySelector('.sortable-list__placeholder');\n    const {top, bottom} = placeholder.getBoundingClientRect();\n    const {offsetHeight} = placeholder;\n\n    if (placeholder.previousElementSibling) {\n      if (bottom - offsetHeight / 2 > item.getBoundingClientRect().bottom) {\n        placeholder.previousElementSibling.before(placeholder);\n      }\n    }\n\n    if (placeholder.nextElementSibling) {\n      if (top + offsetHeight / 2 < item.getBoundingClientRect().top) {\n        placeholder.nextElementSibling.after(placeholder);\n      }\n    }\n  }\n\n  onPointerUp = event => {\n    const item = this.element.querySelector('.sortable-list__item.sortable-list__item_dragging');\n    if (!item) {\n      return;\n    }\n\n    this.stopDragging(item);\n  }\n\n  constructor({items = []}) {\n    this.items = items;\n\n    this.render();\n    this.initEventListeners();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.classList.add('sortable-list');\n\n    this.items.forEach(item => {\n      item.classList.add('sortable-list__item');\n    });\n\n    this.element.append(...this.items);\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('pointerdown', this.onPointerDown);\n    this.element.addEventListener('dragstart', () => false);\n  }\n\n  moveAt(x, y, element) {\n    element.style.left = `${x}px`;\n    element.style.top = `${y}px`;\n  }\n\n  startDragging(x, y, element) {\n    this.indexFrom = this.getIndex(element);\n\n    const rect = element.getBoundingClientRect();\n\n    this.shiftX = x - rect.left;\n    this.shiftY = y - rect.top;\n\n    element.classList.add('sortable-list__item_dragging');\n    element.style.width = `${rect.width}px`;\n    element.style.height = `${rect.height}px`;\n    element.style.left = `${rect.left}px`;\n    element.style.top = `${rect.top}px`;\n\n    element.after(this.createPlaceholder(rect.width, rect.height));\n\n    // move to the bottom of the list\n    element.parentElement.append(element);\n\n    document.addEventListener('pointermove', this.onPointerMove);\n    document.addEventListener('pointerup', this.onPointerUp);\n  }\n\n  stopDragging(element) {\n    element.classList.remove('sortable-list__item_dragging');\n    element.style.cssText = '';\n\n    const placeholder = this.element.querySelector('.sortable-list__placeholder');\n    placeholder.before(element);\n    placeholder.remove();\n\n    document.removeEventListener('pointermove', this.onPointerMove);\n    document.removeEventListener('pointerdown', this.onPointerDown);\n\n    const indexTo = this.getIndex(element);\n\n    if (this.indexFrom !== indexTo) {\n      this.element.dispatchEvent(new CustomEvent('list-order-update', {\n        bubbles: true,\n        detail: {\n          indexFrom: this.indexFrom,\n          indexTo: indexTo\n        }\n      }));\n    }\n  }\n\n  createPlaceholder(width, height) {\n    const placeholder = document.createElement('div');\n\n    placeholder.classList.add('sortable-list__placeholder');\n    placeholder.style.width = `${width}px`;\n    placeholder.style.height = `${height}px`;\n\n    return placeholder;\n  }\n\n  getIndex(element) {\n    let i = 0;\n    let current = element;\n    while (current.previousElementSibling) {\n      current = current.previousElementSibling;\n      i++;\n    }\n    return i;\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n  }\n}\n"],"sourceRoot":""}