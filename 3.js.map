{"version":3,"sources":["webpack:///./src/pages/base-page/index.js","webpack:///./src/components/column-chart/index.js","webpack:///./src/pages/dashboard/bestsellers-header.js","webpack:///./src/pages/dashboard/index.js","webpack:///./src/constants/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/sortable-table/index.js","webpack:///./src/components/range-picker/index.js"],"names":["BasePage","constructor","path","this","element","document","createElement","innerHTML","template","firstElementChild","subElements","getSubElements","components","getComponents","Object","keys","forEach","key","append","initEventListeners","parent","result","subElement","querySelectorAll","dataset","remove","destroy","values","component","ColumnChart","url","range","from","Date","to","label","link","formatHeading","data","event","target","closest","classList","add","URL","BACKEND_URL","render","catch","error","Notification","message","type","NOTIFICATION_TYPE","show","loadData","linkText","chartHeight","addEventListener","onMouseOver","onMouseOut","getChartColumns","columnProps","getColumnProps","entries","map","value","index","getChartColumn","join","properties","tooltip","formatDate","escapeHtml","toLocaleDateString","LOCALE","year","month","day","searchParams","set","toISOString","fetchJson","updateChart","header","body","textContent","calculateValue","reduce","previous","current","maxValue","Math","max","scale","item","percent","toFixed","String","floor","id","title","sortable","sortType","category","getTooltip","toLocaleString","Page","super","updateComponents","detail","onDateSelect","today","setMonth","getMonth","rangePicker","RangePicker","ordersChart","ORDERS_URL","salesChart","SALES_URL","customersChart","CUSTOMERS_URL","sortableTable","SortableTable","BESTSELLERS_URL","sortLocally","scrollable","rowUrl","row","Promise","all","update","PRODUCTS_REST_URL","CATEGORIES_REST_URL","SUBCATEGORIES_REST_URL","ORDERS_REST_URL","process","IMGUR_UPLOAD_URL","IMGUR_CLIENT_ID","success","duration","currentNotification","timeoutId","setTimeout","clearTimeout","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","Error","window","reason","alert","string","replace","headerConfig","sorted","find","order","isRunning","scrollY","innerHeight","documentElement","scrollHeight","start","length","end","pageSize","finally","column","sort","asc","desc","sortOnClient","updateSort","renderRows","sortData","sortOnServer","onPointerDown","onWindowScroll","appendRows","setSearchParam","name","delete","arrow","querySelector","appendChild","toggleEmpty","getTableRows","push","rows","childNodes","getHeaderCell","getRowTemplate","getTableRow","removeEventListener","sortedColumn","sortFunction","value1","value2","localeCompare","caseFirst","number","custom","direction","getWeekday","date","getDay","WEEKDAYS","Array","fill","_","setDate","d1","d2","weekday","MONTHS","contains","closeSelector","openSelector","button","selectedDate","selectionStarted","selectionFrom","clearSelection","getSelection","getTime","selectedRange","doSelection","updateInput","calendarVisibleFrom","addMonth","updateCalendar","firstDayOfMonth","newDate","numberOfMonthsToAdd","addDay","numberOfDaysToAdd","getDate","Intl","DateTimeFormat","format","buildSelector","dateFrom","selector","getCalendarMonth","getLeft","moveBackward","getRight","moveForward","getDates","renderDate","fromDate","dates","style","input","onInputClick","onSelectorClick","onExternalClick","capture","childElementCount","dispatchEvent","CustomEvent","bubbles","tokens","selectors"],"mappings":"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","file":"3.js","sourcesContent":["export default class BasePage {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(path) {\n\n  }\n\n  async render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = this.template;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    this.components = await this.getComponents();\n\n    Object.keys(this.components).forEach(key => {\n      this.subElements[key].append(this.components[key].element);\n    });\n\n    this.initEventListeners();\n\n    return this.element;\n  }\n\n  initEventListeners() {\n\n  }\n\n  get template() {\n    return `<div></div>`;\n  }\n\n  getSubElements(parent) {\n    const result = {};\n\n    for (const subElement of parent.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  async getComponents() {\n    return {};\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n    Object.values(this.components).forEach(component => component.destroy());\n    this.components = {};\n  }\n}\n","import Notification from '../notification/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\nimport { NOTIFICATION_TYPE, BACKEND_URL, LOCALE } from '../../constants/index.js';\n\nexport default class ColumnChart {\n  element;\n  subElements = {};\n  chartHeight = 50;\n\n  onMouseOver = event => {\n    const element = event.target.closest('.column-chart__chart');\n    if (!element) {\n      return;\n    }\n    element.classList.add('has-hovered');\n    event.target.classList.add('is-hovered');\n  }\n\n  onMouseOut = event => {\n    const element = event.target.closest('.column-chart__chart');\n    if (!element) {\n      return;\n    }\n    element.classList.remove('has-hovered');\n    event.target.classList.remove('is-hovered');\n  }\n\n  constructor({\n                url = '',\n                range = {\n                  from: new Date(),\n                  to: new Date(),\n                },\n                label = '',\n                link = '',\n                formatHeading = data => data\n              } = {}) {\n    this.url = new URL(url, BACKEND_URL);\n    this.range = range;\n    this.label = label;\n    this.link = link;\n    this.formatHeading = formatHeading;\n\n    this.render()\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n\n  async render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = this.template;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    await this.loadData();\n\n    this.initEventListeners();\n  }\n\n  get template() {\n    const linkText = this.link ? 'Подробнее' : '';\n    return `\n      <div class=\"column-chart\" style=\"--chart-height: ${this.chartHeight}\">\n        <div class=\"column-chart__title\">\n          ${this.label}\n          <a class=\"column-chart__link\" href=\"${this.link}\">${linkText}</a>\n        </div>\n        <div class=\"column-chart__container\">\n          <div data-element=\"header\" class=\"column-chart__header\"></div>\n          <div data-element=\"body\" class=\"column-chart__chart\"></div>\n        </div>\n      </div>\n    `;\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('mouseover', this.onMouseOver);\n    this.element.addEventListener('mouseout', this.onMouseOut);\n  }\n\n  getChartColumns() {\n    const columnProps = this.getColumnProps(Object.values(this.data));\n\n    return Object.entries(this.data)\n      .map(([key, value], index) => this.getChartColumn(key, value, columnProps[index]))\n      .join('');\n  }\n\n  getChartColumn(key, value, properties) {\n    const tooltip = `\n      <div>\n        <small>${this.formatDate(key)}</small>\n      </div>\n      <strong>${this.formatHeading(value)}</strong>\n    `;\n\n    return `\n      <div style=\"--value: ${properties.value}\" data-tooltip=\"${escapeHtml(tooltip)}\"></div>\n    `;\n  }\n\n  formatDate(data) {\n    const options = {year: 'numeric', month: 'short', day: 'numeric'};\n\n    return new Date(data).toLocaleDateString(LOCALE, options);\n  }\n\n  getSubElements(element) {\n    const result = {};\n\n    for (const subElement of element.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  async loadData() {\n    this.url.searchParams.set('from', this.range.from.toISOString());\n    this.url.searchParams.set('to', this.range.to.toISOString());\n\n    this.element.classList.add('column-chart_loading');\n\n    this.data = await fetchJson(this.url);\n    this.updateChart();\n\n    this.element.classList.remove('column-chart_loading');\n  }\n\n  async update(from, to) {\n    this.range = {from, to};\n    await this.loadData();\n  }\n\n  updateChart() {\n    const {header, body} = this.subElements;\n    header.textContent = this.formatHeading(this.calculateValue());\n    body.innerHTML = this.getChartColumns();\n  }\n\n  calculateValue() {\n    return Object.values(this.data).reduce((previous, current) => previous + current, 0);\n  }\n\n  getColumnProps(data) {\n    const maxValue = Math.max(...data);\n    const scale = this.chartHeight / maxValue;\n\n    return data.map(item => {\n      return {\n        percent: (item / maxValue * 100).toFixed(0) + '%',\n        value: String(Math.floor(item * scale))\n      };\n    });\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n  }\n}\n","import escapeHtml from '../../utils/escape-html.js';\nimport { LOCALE } from '../../constants/index.js';\n\nconst header = [\n  {\n    id: 'images',\n    title: 'Фото',\n    sortable: false,\n    template: data => {\n      return `\n        <div class=\"sortable-table__cell\">\n          <img class=\"sortable-table-image\" alt=\"Image\" src=\"${data[0].url}\">\n        </div>\n      `;\n    }\n  },\n  {\n    id: 'title',\n    title: 'Название',\n    sortable: true,\n    sortType: 'string'\n  },\n  {\n    id: 'subcategory',\n    title: 'Категория',\n    sortable: false,\n    template: data => {\n      return `\n        <div class=\"sortable-table__cell\">\n          <span data-tooltip=\"${escapeHtml(getTooltip(data))}\">${data.title}</span>\n        </div>\n      `;\n    }\n  },\n  {\n    id: 'quantity',\n    title: 'Количество',\n    sortable: true,\n    sortType: 'number'\n  },\n  {\n    id: 'price',\n    title: 'Цена',\n    sortable: true,\n    sortType: 'number',\n    template: data => {\n      return `\n        <div class=\"sortable-table__cell\">\n          $${data.toLocaleString(LOCALE)}\n        </div>\n      `;\n    }\n  },\n  {\n    id: 'sales',\n    title: 'Продажи',\n    sortable: true,\n    sortType: 'number'\n  }\n];\n\nfunction getTooltip(data) {\n  return `\n    <div class=\"sortable-table-tooltip\">\n      <span class=\"sortable-table-tooltip__category\">${data.category.title}</span> /\n      <b class=\"sortable-table-tooltip__subcategory\">${data.title}</b>\n    </div>\n  `;\n}\n\nexport default header;\n","import BasePage from '../base-page/index.js';\nimport RangePicker from '../../components/range-picker/index.js';\nimport SortableTable from '../../components/sortable-table/index.js';\nimport ColumnChart from '../../components/column-chart/index.js';\nimport Notification from '../../components/notification/index.js';\nimport header from './bestsellers-header.js';\nimport { LOCALE, NOTIFICATION_TYPE, ORDERS_URL, SALES_URL, CUSTOMERS_URL, BESTSELLERS_URL } from '../../constants/index.js';\n\nexport default class Page extends BasePage {\n  onDateSelect = event => {\n    this.updateComponents(event.detail.from, event.detail.to);\n  }\n\n  constructor(path) {\n    super(path);\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('date-select', this.onDateSelect);\n  }\n\n  get template() {\n    return `\n      <div class=\"dashboard full-height flex-column\">\n        <div class=\"content__top-panel\">\n          <h2 class=\"page-title\">Панель управления</h2>\n          <div data-element=\"rangePicker\"></div>\n        </div>\n        <div class=\"dashboard__charts\">\n          <div data-element=\"ordersChart\" class=\"dashboard__chart_orders\"></div>\n          <div data-element=\"salesChart\" class=\"dashboard__chart_sales\"></div>\n          <div data-element=\"customersChart\" class=\"dashboard__chart_customers\"></div>\n        </div>\n        <h3 class=\"block-title\">Лидеры продаж</h3>\n        <div data-element=\"sortableTable\"></div>\n      </div>\n    `;\n  }\n\n  async getComponents() {\n    const today = new Date();\n\n    const to = new Date(today);\n    const from = new Date(today.setMonth(today.getMonth() - 1));\n\n    const rangePicker = new RangePicker({from, to});\n\n    const ordersChart = new ColumnChart({\n      url: ORDERS_URL,\n      label: 'Заказы',\n      range: {from, to},\n      link: '/sales'\n    });\n\n    const salesChart = new ColumnChart({\n      url: SALES_URL,\n      label: 'Продажи',\n      range: {from, to},\n      formatHeading: data => `$${data.toLocaleString(LOCALE)}`\n    });\n\n    const customersChart = new ColumnChart({\n      url: CUSTOMERS_URL,\n      label: 'Клиенты',\n      range: {from, to}\n    });\n\n    const sortableTable = new SortableTable(header, {\n      url: `${BESTSELLERS_URL}?from=${from.toISOString()}&to=${to.toISOString()}`,\n      sortLocally: true,\n      scrollable: false,\n      rowUrl: row => `/products/${row.id}`\n    });\n\n    return {\n      rangePicker,\n      ordersChart,\n      salesChart,\n      customersChart,\n      sortableTable\n    };\n  }\n\n  async updateComponents(from, to) {\n    Promise.all([\n      this.components.ordersChart.update(from, to),\n      this.components.salesChart.update(from, to),\n      this.components.customersChart.update(from, to),\n      this.components.sortableTable.update({from: from.toISOString(), to: to.toISOString()})\n    ]).catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n}\n","export const ORDERS_URL = 'api/dashboard/orders';\nexport const SALES_URL = 'api/dashboard/sales';\nexport const CUSTOMERS_URL = 'api/dashboard/customers';\nexport const BESTSELLERS_URL = 'api/dashboard/bestsellers';\n\nexport const PRODUCTS_REST_URL = 'api/rest/products';\nexport const CATEGORIES_REST_URL = 'api/rest/categories';\nexport const SUBCATEGORIES_REST_URL = 'api/rest/subcategories';\nexport const ORDERS_REST_URL = 'api/rest/orders';\n\nexport const BACKEND_URL = process.env.BACKEND_URL;\nexport const IMGUR_UPLOAD_URL = process.env.IMGUR_UPLOAD_URL;\nexport const IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\n\nexport const LOCALE = process.env.LOCALE;\n\nexport const NOTIFICATION_TYPE = {\n  success: 'success',\n  error: 'error'\n};\n","export default class Notification {\n\n  static currentNotification = null;\n\n  constructor(message = '', {duration = 2000, type = ''} = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = `\n      <div class=\"notification notification_${this.type} show\">\n        <div class=\"notification-body notification__content\">${this.message}</div>\n      </div>\n    `;\n    this.element = this.element.firstElementChild;\n  }\n\n  show(element = document.body) {\n    if (Notification.currentNotification) {\n      Notification.currentNotification.remove();\n    }\n\n    element.append(this.element);\n\n    this.timeoutId = setTimeout(() => {this.remove()}, this.duration)\n    Notification.currentNotification = this;\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n    clearTimeout(this.timeoutId);\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    Notification.currentNotification = null;\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function(url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch(err) {\n    throw new FetchError(response, \"Network error has occurred.\");\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\n    } catch (error) { /* ignore failed body */ }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch(err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = \"FetchError\";\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n\n","export default string => string\n  .replace(/&/g, '&amp;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#39;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n","import Notification from '../notification/index.js';\nimport fetchJson from '../../utils/fetch-json.js';\nimport { NOTIFICATION_TYPE, BACKEND_URL } from '../../constants/index.js';\n\nexport default class SortableTable {\n  element;\n  subElements = {};\n  pageSize = 30;\n\n  onWindowScroll = () => {\n    if (this.isRunning) {\n      return;\n    }\n\n    const isScrolledToBottom = window.scrollY + window.innerHeight >= document.documentElement.scrollHeight;\n\n    if (isScrolledToBottom) {\n      this.isRunning = true;\n\n      const start = this.data.length;\n      const end = this.data.length + this.pageSize;\n\n      this.loadData(start, end, true)\n        .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show())\n        .finally(() => this.isRunning = false);\n    }\n  }\n\n  onPointerDown = event => {\n    const column = event.target.closest('.sortable-table__cell[data-sortable]');\n\n    if (!column) {\n      return;\n    }\n\n    const toggle = {\n      asc: 'desc',\n      desc: 'asc'\n    };\n\n    this.sort(column.dataset.id, toggle[column.dataset.order]);\n  }\n\n  constructor(headerConfig = [], {\n    url = '',\n    sortLocally = false,\n    sorted = {\n      id: headerConfig.find(item => item.sortable).id,\n      order: 'asc'\n    },\n    scrollable = true,\n    rowUrl = null\n  } = {}) {\n    this.headerConfig = headerConfig;\n    this.rowUrl = rowUrl;\n    this.url = new URL(url, BACKEND_URL);\n    this.sortLocally = sortLocally;\n    this.sorted = sorted;\n    this.scrollable = scrollable;\n\n    this.render()\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n\n  sortOnClient(id, order) {\n    this.updateSort(id, order);\n    this.renderRows(this.sortData(id, order));\n  }\n\n  sortOnServer(id, order) {\n    this.updateSort(id, order);\n    this.loadData()\n      .catch(error => new Notification(error.message, {type: NOTIFICATION_TYPE.error}).show());\n  }\n\n  initEventListeners() {\n    this.subElements.header.addEventListener('pointerdown', this.onPointerDown);\n    if (this.scrollable) {\n      window.addEventListener('scroll', this.onWindowScroll);\n    }\n  }\n\n  async render() {\n    this.element = document.createElement('div');\n    this.element.innerHTML = this.template;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    await this.loadData();\n\n    this.initEventListeners();\n  }\n\n  async loadData(start = 0, end = this.pageSize, append = false) {\n    this.url.searchParams.set('_sort', this.sorted.id);\n    this.url.searchParams.set('_order', this.sorted.order);\n    this.url.searchParams.set('_start', String(start));\n    this.url.searchParams.set('_end', String(end));\n\n    this.element.classList.add('sortable-table_loading');\n\n    const data = await fetchJson(this.url);\n\n    if (append) {\n      this.appendRows(data);\n    } else {\n      this.renderRows(data);\n    }\n\n    this.element.classList.remove('sortable-table_loading');\n  }\n\n  setSearchParam(name, value) {\n    if (value) {\n      this.url.searchParams.set(name, value);\n    } else {\n      this.url.searchParams.delete(name);\n    }\n  }\n\n  async update(searchParams = {}) {\n    Object.entries(searchParams).forEach(([name, value]) => this.setSearchParam(name, value));\n    await this.loadData();\n  }\n\n  updateSort(id, order) {\n    this.sorted = {id, order};\n\n    const {header, arrow} = this.subElements;\n\n    header.querySelectorAll('[data-sortable]')\n      .forEach(column => {\n        column.dataset.order = order;\n      });\n\n    header.querySelector(`[data-id=\"${id}\"]`).appendChild(arrow);\n  }\n\n  toggleEmpty() {\n    if (this.data.length) {\n      this.element.classList.remove('sortable-table_empty');\n    } else {\n      this.element.classList.add('sortable-table_empty');\n    }\n  }\n\n  renderRows(data) {\n    this.data = data;\n    this.subElements.body.innerHTML = this.getTableRows(data);\n    this.toggleEmpty();\n  }\n\n  appendRows(data) {\n    this.data.push(...data);\n\n    const rows = document.createElement('div');\n    rows.innerHTML = this.getTableRows(data);\n    this.subElements.body.append(...rows.childNodes);\n\n    this.toggleEmpty();\n  }\n\n  get template() {\n    return `\n      <div class=\"sortable-table\">\n        <div data-element=\"header\" class=\"sortable-table__header sortable-table__row\">\n          ${this.headerConfig.map(column => this.getHeaderCell(column)).join('')}\n        </div>\n        <div data-element=\"body\" class=\"sortable-table__body\"></div>\n        <div data-element=\"loading\" class=\"loading-line sortable-table__loading-line\"></div>\n        <div data-element=\"emptyPlaceholder\" class=\"sortable-table__empty-placeholder\">\n          <div>Нет данных</div>\n        </div>\n      </div>\n    `;\n  }\n\n  getHeaderCell({id, title, sortable}) {\n    const arrow =`\n      <span data-element=\"arrow\" class=\"sortable-table__sort-arrow\">\n        <span class=\"sort-arrow\"></span>\n      </span>\n    `;\n\n    return `\n      <div class=\"sortable-table__cell\" data-id=\"${id}\" ${sortable ? 'data-sortable=\"\"' : ''} data-order=\"${this.sorted.order}\">\n        <span>${title}</span>\n        ${id === this.sorted.id ? arrow : ''}\n      </div>\n    `;\n  }\n\n  getTableRows(data) {\n    return data.map(row => this.getRowTemplate(row)).join('');\n  }\n\n  getRowTemplate(row) {\n    if (this.rowUrl) {\n      return `\n        <a class=\"sortable-table__row\" href=\"${this.rowUrl(row)}\">\n          ${this.getTableRow(row)}\n        </a>\n      `;\n    } else {\n      return `\n        <div class=\"sortable-table__row\">\n          ${this.getTableRow(row)}\n        </div>\n      `;\n    }\n  }\n\n  getTableRow(data) {\n    return this.headerConfig\n      .map(({id, template}) => template ? template(data[id]) : `<div class='sortable-table__cell'>${data[id]}</div>`)\n      .join('');\n  }\n\n  getSubElements(parent) {\n    const result = {};\n\n    for (const subElement of parent.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n    if (this.scrollable) {\n      window.removeEventListener('scroll', this.onWindowScroll);\n    }\n  }\n\n  sort(id, order) {\n    if (this.sortLocally) {\n      this.sortOnClient(id, order);\n    } else {\n      this.sortOnServer(id, order);\n    }\n  }\n\n  sortData(id, order) {\n    const sortedColumn = this.headerConfig.find(column => column.id === id);\n    const sortType = sortedColumn.sortType;\n\n    const sortFunction = {\n      string: (value1, value2) => value1.localeCompare(value2, ['ru', 'en'], {caseFirst: 'upper'}),\n      number: (value1, value2) => value1 - value2,\n      custom: sortedColumn.sortFunction\n    };\n\n    const direction = {\n      asc: 1,\n      desc: -1\n    };\n\n    return [...this.data].sort((value1, value2) =>\n      direction[order] * sortFunction[sortType](value1[id], value2[id])\n    );\n  }\n}\n","import { LOCALE } from '../../constants/index.js';\n\nconst getWeekday = date => (date.getDay() + 7 - 1) % 7;\n\nconst WEEKDAYS = new Array(7)\n  .fill(1)\n  .map((_, index) => new Date(new Date().setDate(index)))\n  .sort((d1, d2) => getWeekday(d1) - getWeekday(d2))\n  .map(date => date.toLocaleDateString(LOCALE, { weekday: 'short' }));\n\nconst MONTHS = new Array(12)\n  .fill(1)\n  .map((_, index) => new Date(new Date().setMonth(index)).toLocaleDateString(LOCALE, { month: 'long'}))\n\nexport default class RangePicker {\n  element;\n  subElements = {};\n\n  onInputClick = () => {\n    if (!this.element.classList.contains('rangepicker_open')) {\n      this.openSelector();\n    } else {\n      this.closeSelector();\n    }\n  }\n\n  onSelectorClick = event => {\n    const button = event.target.closest('.rangepicker__cell');\n\n    if (!button) {\n      return;\n    }\n\n    const selectedDate = new Date(button.dataset.value);\n\n    if (!this.selectionStarted) {\n      // start new selection\n      this.selectionStarted = true;\n      this.selectionFrom = selectedDate;\n\n      this.clearSelection();\n      button.classList.add('rangepicker__selected-from');\n      return;\n    }\n\n    // finish selection\n    this.selectionStarted = false;\n\n    const getSelection = type => new Date(Math[type](this.selectionFrom.getTime(), selectedDate.getTime()));\n\n    this.selectedRange.from = getSelection('min');\n    this.selectedRange.to = getSelection('max');\n\n    // clear previous selection in case first selected date > second selected date\n    this.clearSelection(['rangepicker__selected-from']);\n    this.doSelection();\n    this.updateInput();\n    this.closeSelector();\n  }\n\n  onExternalClick = event => {\n    const target = event.target.closest('.rangepicker');\n    if (!target) {\n      this.closeSelector();\n    }\n  }\n\n  moveBackward = () => {\n    this.calendarVisibleFrom = this.addMonth(this.calendarVisibleFrom, -1);\n    this.updateCalendar(this.calendarVisibleFrom);\n  }\n\n  moveForward = () => {\n    this.calendarVisibleFrom = this.addMonth(this.calendarVisibleFrom);\n    this.updateCalendar(this.calendarVisibleFrom);\n  }\n\n  constructor({\n                from = new Date(),\n                to = new Date()\n              }) {\n    this.selectedRange = {from, to};\n    this.calendarVisibleFrom = this.firstDayOfMonth(from);\n\n    this.render();\n    this.initEventListeners();\n  }\n\n  firstDayOfMonth(date) {\n    const newDate = new Date(date);\n    newDate.setDate(1);\n    return newDate;\n  }\n\n  addMonth(date, numberOfMonthsToAdd = 1) {\n    const newDate = new Date(date);\n    newDate.setMonth(newDate.getMonth() + numberOfMonthsToAdd);\n    return newDate;\n  }\n\n  addDay(date, numberOfDaysToAdd = 1) {\n    const newDate = new Date(date);\n    newDate.setDate(newDate.getDate() + numberOfDaysToAdd);\n    return newDate;\n  }\n\n  render() {\n    const {from, to} = this.selectedRange;\n\n    this.element = document.createElement('div');\n    this.element.innerHTML = `\n      <div class=\"rangepicker\">\n        <div class=\"rangepicker__input\" data-element=\"input\">\n          <span data-element=\"from\">${new Intl.DateTimeFormat(LOCALE).format(from)}</span> -\n          <span data-element=\"to\">${new Intl.DateTimeFormat(LOCALE).format(to)}</span>\n        </div>\n        <div class=\"rangepicker__selector\" data-element=\"selector\"></div>\n      </div>\n    `;\n    this.element = this.element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n  }\n\n  buildSelector(dateFrom) {\n    this.subElements.selector.innerHTML = `\n      <div class=\"rangepicker__selector-arrow\"></div>\n      <div class=\"rangepicker__selector-control-left\"></div>\n      <div class=\"rangepicker__selector-control-right\"></div>\n      <div class=\"rangepicker__calendar\">\n        ${this.getCalendarMonth(this.firstDayOfMonth(dateFrom))}\n      </div>\n      <div class=\"rangepicker__calendar\">\n        ${this.getCalendarMonth(this.firstDayOfMonth(this.addMonth(dateFrom)))}\n      </div>\n    `;\n\n    this.doSelection();\n\n    this.getLeft().addEventListener('click', this.moveBackward);\n    this.getRight().addEventListener('click', this.moveForward);\n  }\n\n  updateCalendar(dateFrom) {\n    let date = this.firstDayOfMonth(dateFrom);\n\n    this.subElements.selector.querySelectorAll('.rangepicker__calendar')\n      .forEach(value => {\n        value.innerHTML = this.getCalendarMonth(date);\n        date = this.addMonth(date);\n      });\n\n    this.doSelection();\n  }\n\n  getCalendarMonth(date) {\n    return `\n      <div class=\"rangepicker__month-indicator\">\n        <time dateTime=\"${MONTHS[date.getMonth()]}\">${MONTHS[date.getMonth()]}</time>\n      </div>\n      <div class=\"rangepicker__day-of-week\">\n        ${WEEKDAYS.map(value => `<div>${value}</div>`).join('')}\n      </div>\n      <div class=\"rangepicker__date-grid\">\n        ${this.getDates(date).map(value => this.renderDate(value)).join('')}\n      </div>\n    `;\n  }\n\n  getDates(fromDate) {\n    const dates = [];\n\n    let current = fromDate;\n    while (current < this.addMonth(fromDate)) {\n      dates.push(current);\n      current = this.addDay(current);\n    }\n\n    return dates;\n  }\n\n  renderDate(date) {\n    const style = date.getDate() === 1 ? `style=\"--start-from: ${getWeekday(date)}\"` : '';\n    return `\n      <button type=\"button\" class=\"rangepicker__cell\" data-value=\"${date.toISOString()}\" ${style}>\n        ${date.getDate()}\n      </button>\n    `;\n  }\n\n  getSubElements(parent) {\n    const result = {};\n\n    for (const subElement of parent.querySelectorAll('[data-element]')) {\n      result[subElement.dataset.element] = subElement;\n    }\n    return result;\n  }\n\n  initEventListeners() {\n    this.subElements.input.addEventListener('click', this.onInputClick);\n    this.subElements.selector.addEventListener('click', this.onSelectorClick);\n    document.addEventListener('click', this.onExternalClick, {capture: true});\n  }\n\n  openSelector() {\n    if (!this.subElements.selector.childElementCount) {\n      this.buildSelector(this.selectedRange.from);\n    }\n    this.element.classList.add('rangepicker_open');\n  }\n\n  closeSelector() {\n    this.element.classList.remove('rangepicker_open');\n  }\n\n  updateInput() {\n    const {from, to} = this.selectedRange;\n\n    this.subElements.from.textContent = new Intl.DateTimeFormat(LOCALE).format(from);\n    this.subElements.to.textContent = new Intl.DateTimeFormat(LOCALE).format(to);\n\n    this.element.dispatchEvent(new CustomEvent('date-select', {\n      bubbles: true,\n      detail: {from, to}\n    }));\n  }\n\n  getLeft() {\n    return this.subElements.selector.querySelector('.rangepicker__selector-control-left');\n  }\n\n  getRight() {\n    return this.subElements.selector.querySelector('.rangepicker__selector-control-right');\n  }\n\n  clearSelection(tokens = ['rangepicker__selected-from', 'rangepicker__selected-to', 'rangepicker__selected-between']) {\n    const selectors = tokens.map(value => `.${value}`).join(', ');\n    this.subElements.selector.querySelectorAll(selectors)\n      .forEach(value => value.classList.remove(...tokens));\n  }\n\n  doSelection() {\n    const {from, to} = this.selectedRange;\n\n    this.subElements.selector.querySelectorAll('.rangepicker__cell')\n      .forEach(value => {\n        const date = new Date(value.dataset.value);\n\n        if (date.getTime() === from.getTime()) {\n          value.classList.add('rangepicker__selected-from');\n\n        } else if (to && date.getTime() === to.getTime()) {\n          value.classList.add('rangepicker__selected-to');\n\n        } else if (to && date > from && date < to) {\n          value.classList.add('rangepicker__selected-between');\n        }\n      });\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove()\n    }\n  }\n\n  destroy() {\n    document.removeEventListener('click', this.onExternalClick, { capture: true });\n\n    this.remove();\n    this.element = null;\n    this.subElements = {};\n  }\n}\n"],"sourceRoot":""}